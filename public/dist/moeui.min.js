!function(a){_.setLang("en"),a.Moe={module:function(a,b){"use strict";var c,d;c=Moe[a]={},d=Moe[a.toLowerCase()+"s"]={},b.call(c,c,Moe)}}}(window),Moe.module("Form",function(a,b){"use strict";var c=["date","hour","time"],d=["onClick","onChange"],e={className:"",disabled:!1,name:""},f=function(a){a||(a={}),this.get("locale")&&this.set("value",_.parseLocale(this.get("locale"))),_.each(a,function(b,c){_.contains(d,c)&&_.isString(b)&&this.set(c,new Function(a[c]))},this)};a._ButtonModel=Backbone.Model.extend({defaults:_.extend({},e,{layout:"button",icon:"",locale:"",value:""}),initialize:function(a){f.apply(this,arguments)}}),a._ButtonView=Backbone.ItemView.extend({template:'<button type="button"<% if (name) { %> name="<%= name %>"<% } %><% if (className) { %> class="<%= className %>"<% } %><% if (disabled) { %> disabled<% } %>><% if (icon) { %><i class="icon-btn icon-<%= icon %>"></i><% } %><span<% if (locale) { %> data-locale="<%= locale %>"<% } %>><%= value %></span></button>',events:{click:"onClick"},onRender:function(){this.setElement(this.$el.html())},onClick:function(){this.isDisabled()||_.isFunction(this.get("onClick"))&&this.get("onClick").apply(this,arguments)},isDisabled:function(){return this.get("disabled")},disable:function(){this.set("disabled",!0),this.$el.prop("disabled",!0)},enable:function(){this.set("disabled",!1),this.$el.prop("disabled",!1)}}),a._InputModel=a._PasswordModel=a._TextareaModel=Backbone.Model.extend({defaults:_.extend({},e,{layout:"input",errorMessage:null,icon:"",locale:"",placeholder:"",placeLocale:"",value:null,validateOnCreate:!1,validation:null}),initialize:function(a){f.apply(this,arguments),this.get("placeLocale")&&this.set("placeholder",_.parseLocale(this.get("placeLocale")))},getVal:function(){return this.get("value")},errorText:function(){var a=this.get("errorMessage")||{},b=_.contains(c,this.get("layout"));return _.map(this.validationError,function(c,d){return a[d]?a[d]:_.template(_.parseLocale("ERR_"+d.toUpperCase()+(b?"_DATE":"")))(this.validationError)},this)},validate:function(a){var b,c=this.get("validation"),d=this.getVal();if(_.isPureObject(c))return c.required&&this.failRequired(d)?{required:!0}:_.notEmpty(d)&&(b=_.pick(c,function(a,b){var c=this["fail"+_.capitalize(b)];return c&&c(d,a)},this),!_.isEmpty(b))?b:void this.trigger("valid")},failRequired:function(a){return!_.notEmpty(a)||a===!1},failMax:function(a,b){return _.num(a)>_.num(b)},failMin:function(a,b){return _.num(a)<_.num(b)},failMaxlength:function(a,b){return a.toString().length>b},failMinlength:function(a,b){return a.toString().length<b},failPattern:function(a,b){return!new RegExp(b).test(a)},failFormat:function(a,b){var c;switch(b){case"email":c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;break;case"money":c=/^[+-]?[0-9]+(\.\d{1,2})?$/;break;case"number":c=/^-?(\d{0,3}(\,\d{3})*|(\d*))(\.\d+)?$/;break;case"idCard":c=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X|x)$/;break;case"tel":c=/^[\d-]+$/g;break;case"url":c=/^((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)$/g}return!c.test(a)}}),a._NumberModel=a._InputModel.extend({defaults:{text:"",digits:null,step:1},initialize:function(a){this._super("initialize",arguments),this.set({validation:_.extend({},this.get("validation"),{format:"number"}),errorMessage:_.extend({},this.get("errorMessage"),{format:_.parseLocale("ERR_FORMAT_NUMBER")})}),this.formatNumber(),this.on("change:value",this.formatNumber)},formatNumber:function(){var a;return _.notEmpty(this.get("value"))?(a=_.formatNumber(this.get("value"),this.get("digits")),void this.set("text",""!==a?a:this.get("value"))):this.set("text","")}}),a._CheckboxModel=a._RadioModel=a._InputModel.extend({defaults:{checked:!1},getVal:function(){return this.get("checked")}}),a._PasswordView=a._InputView=Backbone.ItemView.extend({template:'<div class="control-input<% if (className) { %> <%= className %><% } %><% if (icon) { %> control-input-icon<% } %><% if (validation && validation.required) { %> control-required<% } %>"><input type="<%= layout === \'input\' ? \'text\' : \'password\' %>"<% if (name) { %> name="<%= name %>"<% } %><% if (_.exists(value)) { %> value="<%= value %>"<% } %><% if (placeholder) { %> placeholder="<%= placeholder %>"<% } %><% if (placeLocale) { %> data-locale-placeholder="<%= placeLocale %>"<% } %><% if (disabled) { %> disabled <% } %>><% if (icon) { %><i class="icon-<%= icon %>"></i><% } %></div>',events:{click:"onClick","change :input":"onChange"},modelEvents:{valid:"showValid",invalid:"showInvalid"},onRender:function(){this.setElement(this.$el.html()),this.modelShortcut(["getVal","isValid","hasChanged"]),this.get("validateOnCreate")&&this.isValid()},onChange:function(a){this.setVal($.trim(a.target.value),{updateView:!1}),_.isFunction(this.get("onChange"))&&this.get("onChange").apply(this,arguments)},onClick:function(){this.isDisabled()||_.isFunction(this.get("onClick"))&&this.get("onClick").apply(this,arguments)},showValid:function(){var a=this.$el.removeClass("control-error").addClass("control-success");setTimeout(function(){a.removeClass("control-success").addClass("control-success")},0),this.$(".control-error-message").remove()},showInvalid:function(){var a=this.$el.removeClass("control-success").addClass("control-error");setTimeout(function(){a.removeClass("control-error").addClass("control-error")},0),this.$(".control-error-message").remove(),$("<p></p>",{"class":"control-error-message",html:this.model.errorText().join("<br>")}).appendTo(a)},setVal:function(a,b){b||(b={}),this.set("value",a,b),b.validate!==!1&&this.isValid(),b.updateView!==!1&&this.updateView()},clear:function(){this.setVal(null,{validate:!1}),this.model.validationError=null,this.$el.removeClass("control-success control-error"),this.$(".control-error-message").remove()},updateView:function(){this.$(":text").val(this.getVal())},isDisabled:function(){return this.get("disabled")},disable:function(){this.set("disabled",!0),this.$el.addClass("control-disabled"),this.$(":text").prop("disabled",!0)},enable:function(){this.set("disabled",!1),this.$el.removeClass("control-disabled"),this.$(":text").prop("disabled",!1)},require:function(){this.set("validation",_.extend({},this.get("validation"),{required:!0})),this.$el.addClass("control-required")},unRequire:function(){this.set("validation",_.extend({},this.get("validation"),{required:!1})),this.$el.removeClass("control-required")},show:function(){this.$el.show()},hide:function(){this.$el.hide()}}),a._TextareaView=a._InputView.extend({template:'<div class="control-textarea<% if (className) { %> <%= className %><% } %><% if (validation && validation.required) { %> control-required<% } %>"><textarea<% if (name) { %> name="<%= name %>"<% } %><% if (placeholder) { %> placeholder="<%= placeholder %>"<% } %><% if (placeLocale) { %> data-locale-placeholder="<%= placeLocale %>"<% } %><% if (disabled) { %> disabled <% } %>><% if (_.exists(value)) { %><%= value %><% } %></textarea></div>'}),a._NumberView=a._InputView.extend({template:'<div class="control-number<% if (className) { %> <%= className %><% } %><% if (validation && validation.required) { %> control-required<% } %>""><input type="text" value="<%= text %>"<% if (name) { %> name="<%= name %>"<% } %><% if (placeholder) { %> placeholder="<%= placeholder %>"<% } %><% if (placeLocale) { %> data-locale-placeholder="<%= placeLocale %>"<% } %><% if (disabled) { %> disabled <% } %>><button type="button" class="btn-white btn-icon number-up"<% if (disabled) { %> disabled <% } %>><i class="icon-arrow-caret-up number-icon"></i></button><button type="button" class="btn-white btn-icon number-down"<% if (disabled) { %> disabled <% } %>><i class="icon-arrow-caret-down number-icon"></i></button></div>',events:{"click .number-up":"add","click .number-down":"subtract"},onChange:function(a){var b=$.trim(a.target.value),c=_.notEmpty(b)?_.parseNumber(b):null;this.setVal(_.isNaN(c)?b:c),_.isFunction(this.get("onChange"))&&this.get("onChange").apply(this,arguments)},add:function(){this.step(this.get("step"))},subtract:function(){this.step(-this.get("step"))},updateView:function(){this.$(":text").val(this.get("text"))},step:function(a){_.isNaN(+this.getVal())||(this.setVal(+this.getVal()+a),this.$(":text").trigger("change"))}}),a._CheckboxView=a._RadioView=a._InputView.extend({template:'<label class="control-check<% if (className) { %> <%= className %><% } %><% if (validation && validation.required) { %> control-required<% } %>""><input type="<%= layout %>"<% if (name) { %> name="<%= name %>"<% } %><% if (_.exists(value)) { %> value="<%= value %>"<% } %><% if (checked) { %> checked<% } %><% if (disabled) { %> disabled<% } %>><span<% if (placeLocale) { %> data-locale-placeholder="<%= placeLocale %>"<% } %>><%= placeholder %></span></label>',onChange:function(a){this.setVal(a.target.checked,{updateView:!1}),_.isFunction(this.get("onChange"))&&this.get("onChange").apply(this,arguments)},getVal:function(){return this.get("checked")},setVal:function(a,b){b||(b={}),this.set("checked",a,b),b.validate!==!1&&this.isValid(),b.updateView!==!1&&this.updateView()},updateView:function(){this.$(":input").prop("checked",this.getVal())}}),a.createControl=function(b){return b&&b.layout?new(a["_"+_.capitalize(b.layout)+"View"])({model:new(a["_"+_.capitalize(b.layout)+"Model"])(b)}).render():_.error("No layout")},_.addLang({en:{ERR_REQUIRED:"请输入必填项",ERR_MAXLENGTH:"最多输入 <%= maxlength %> 个字符",ERR_MINLENGTH:"至少输入 <%= minlength %> 个字符",ERR_MAX:"所填数字不能大于 <%= max %>",ERR_MIN:"所填数字不能小于 <%= min %>",ERR_MAX_DATE:'日期不能晚于 <%= _.formatTime(max, "YYYY-MM-DD HH:mm") %>',ERR_MIN_DATE:'日期不能早于 <%= _.formatTime(min, "YYYY-MM-DD HH:mm") %>',ERR_FORMAT:"格式不正确",ERR_FORMAT_NUMBER:"不是正确的数字格式",ERR_PATTERN:"不符合指定格式：<%= pattern %>"},zh:{ERR_REQUIRED:"Please fill in the required field.",ERR_MAXLENGTH:"No more than <%= maxlength %> characters.",ERR_MINLENGTH:"At least <%= minlength %> characters.",ERR_MAX:"The number must be less than <%= max %>.",ERR_MIN:"The number must be more than <%= min %>.",ERR_MAX_DATE:'Date must be earlier than <%= _.formatTime(max, "YYYY-MM-DD HH:mm") %>.',ERR_MIN_DATE:'Date must be later than <%= _.formatTime(min, "YYYY-MM-DD HH:mm") %>.',ERR_FORMAT:"Wrong format.",ERR_FORMAT_NUMBER:"Not valid number.",ERR_PATTERN:"Please follow the required format: <%= pattern %>"}})});